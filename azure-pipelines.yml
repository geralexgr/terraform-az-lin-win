trigger:
- none

pr: none

pool:
  vmImage: ubuntu-latest

parameters:
- name: image
  displayName: VM Image
  type: string
  default: windows
  values:
  - windows
  - linux

stages:

  - stage:
    displayName: Deploy terraform resources
    jobs:
      - job:
        displayName: Deploy vm
        steps:
          - task: CmdLine@2
            displayName: Install terraform CLI
            inputs:
              script: |
                curl -fsSL https://apt.releases.hashicorp.com/gpg | sudo apt-key add -
                sudo apt-add-repository "deb [arch=amd64] https://apt.releases.hashicorp.com $(lsb_release -cs) main"
                sudo apt-get update && sudo apt install terraform

          - task: AzureCLI@2
            displayName: login into your subscription
            inputs:
              azureSubscription: 'Visual Studio Ultimate with MSDN(03270a1d-efad-41a7-8761-2209b8ef3336)'
              scriptType: 'bash'
              scriptLocation: 'inlineScript'
              inlineScript: |
                az login
                az account set --subscription "Visual Studio Ultimate with MSDN"
                
          - task: CmdLine@2
            displayName: Terraform apply 
            inputs:
              script: |
                cd $(Build.SourcesDirectory)/${{ parameters.image}}
                terraform init
                terraform apply -auto-approve 

